#Practical 3. A spatial model

#Model with the BYM convolution prior on the random effects

model
{
  for (i in 1 : N) {
      O[i]  ~ dpois(mu[i])
      log(mu[i]) <- log(E[i]) + alpha + U[i] +V[i]
      V[i] ~ dnorm(0,prec.v)            #  the unstructured random effects
      RR[i] <- exp(alpha + U[i] + V[i]) #  relative risk
      residRR[i] <-                     #  the residual RR    
      PP[i] <- step(residRR[i]-1)   #  posterior probability that residRR is greater than 1
                                        # eps is used to guard against numerical imprecision of step function
 }

# intrinsic CAR prior on spatial random effects
  U[1:N] ~ car.normal(adj[], weights[], num[], prec.u)


# priors:
  alpha  ~ dflat()                     # improper uniform (-infty, +infty) prior 
   
  prec.u ~ dgamma(0.5,0.005)          # prior on precison of spatial area random effects
  sigma2.u <- 1/prec.u                # conditional variance of spatial area random effects
  prec.v ~ dgamma(1,0.001)            # prior on precison of unstructured area random effects
  sigma2.v <- 1/prec.v                 # conditional variance of unstructured area random effects

# other quantity of interest
  overallRR <- exp(alpha)                          # overall RR across study region over the 5-year period
  
}
